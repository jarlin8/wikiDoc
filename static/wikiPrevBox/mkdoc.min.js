"use strict";{document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeend",'<link rel="stylesheet" type="text/css" href="https://niu.fendou.la/wikiPrevBox/mkdoc.min.css">'),document.body.insertAdjacentHTML("afterbegin",'<article id="wikiPreviewBox" class="wikiPreviewBox"></article>');let showNoImages=1,wikiBoxWidth=300,textDirection=document.dir||"";void 0!==document.currentScript.dataset.wikipreview&&(showNoImages=!!document.currentScript.dataset.wikipreview.includes("noimages"),wikiBoxWidth=Math.min(Math.max(parseInt(document.currentScript.dataset.wikipreview.replace(/\D/g,"")||300),200),400));let wikiBoxMaxLenght=280,whatArticle="",wikiArticleUrl="",wikiLang="",wikiTermPos,wikiTerm,wikiPreviewBox=document.getElementById("wikiPreviewBox");wikiPreviewBox.style.width=wikiBoxWidth+"px",wikiPreviewBox.addEventListener("click",hideWikiBox),wikiPreviewBox.addEventListener("mouseover",showWikiBox),wikiPreviewBox.addEventListener("mouseout",hideWikiBox);let allWikiLinks=document.querySelectorAll("[href*='wikipedia.org']:not([href*='#nopreview'])"),allWithNopreview=document.querySelectorAll("[href*='#nopreview']");for(let z=0;z<allWithNopreview.length;z++)allWithNopreview[z].href=allWithNopreview[z].href.replace("#nopreview","");for(let i=0;i<allWikiLinks.length;i++)allWikiLinks[i].classList.add("wikiLink"),"rtl"===textDirection&&allWikiLinks[i].classList.add("wikiLink_rtl"),allWikiLinks[i].addEventListener("mouseover",e=>{wikiTerm=e.currentTarget,wikiArticleUrl=wikiTerm.href,whatArticle=""+wikiArticleUrl.split("/").pop(),wikiLang=wikiArticleUrl.split(".")[0].split("//")[1],wikiTermPos=wikiTerm.getBoundingClientRect();let wikiBoxLeft=wikiTermPos.left-wikiBoxWidth/2+(wikiTermPos.right-wikiTermPos.left)/2;wikiBoxLeft<0&&(wikiBoxLeft=10);let winInnerWidth=window.innerWidth;winInnerWidth<wikiBoxWidth?wikiBoxLeft=winInnerWidth-wikiBoxWidth+(wikiBoxWidth-winInnerWidth):wikiBoxLeft+wikiBoxWidth>winInnerWidth&&(wikiBoxLeft=winInnerWidth-wikiBoxWidth-20),wikiPreviewBox.style.left=wikiBoxLeft+"px",getWikiPreviewData(whatArticle,wikiLang)},!1),allWikiLinks[i].addEventListener("click",event=>{event.preventDefault()}),allWikiLinks[i].addEventListener("mouseout",hideWikiBox),document.addEventListener('DOMContentLoaded',event=>{event.preventDefault()});function getWikiPreviewData(whatArticle,whatLang="en"){let showThisImgAnyway=(whatArticle=(whatArticle.charAt(0).toUpperCase()+whatArticle.slice(1)).replace(/ /g,"_")).includes("#showimage");showThisImgAnyway&&(whatArticle=whatArticle.replace("#showimage",""));let arrArticleSummary=[];navigator.onLine&&fetch("https://"+whatLang+".m.wikipedia.org/api/rest_v1/page/summary/"+whatArticle).then(response=>{response.status>=200&&response.status<=299&&response.json().then(wikiSummData=>{arrArticleSummary=wikiSummData.hasOwnProperty("thumbnail")&&!showNoImages||showThisImgAnyway?["<img height='"+wikiSummData.thumbnail.height+"' src='"+wikiSummData.thumbnail.source+"'/>",wikiSummData.extract_html,"https://"+whatLang+".wikipedia.org/wiki/"+whatArticle,wikiSummData.title]:["",wikiSummData.extract_html,"https://"+whatLang+".wikipedia.org/wiki/"+whatArticle,wikiSummData.title],createWikiBox(arrArticleSummary,wikiSummData.dir)})})}function createWikiBox(arrArticleSum,textDirection){let wikiBoxContent="";if(wikiBoxContent=arrArticleSum[0],arrArticleSum[1].length<=wikiBoxMaxLenght)wikiBoxContent+=arrArticleSum[1],"."==wikiBoxContent.slice(-1)&&(wikiBoxContent=wikiBoxContent.substring(0,wikiBoxContent.length-1));else{let lastClosingTag=arrArticleSum[1].substr(arrArticleSum[1].lastIndexOf("<"),arrArticleSum[1].length);wikiBoxContent+="</p>"===lastClosingTag?arrArticleSum[1].substring(0,wikiBoxMaxLenght-3):arrArticleSum[1].substring(0,wikiBoxMaxLenght-9),"."==wikiBoxContent.slice(-1)&&(wikiBoxContent=wikiBoxContent.substring(0,wikiBoxContent.length-1)),wikiBoxContent+="&nbsp;..."+lastClosingTag}wikiPreviewBox.innerHTML=wikiBoxContent;let wikiBoxfooter="<span class='wikiBoxfooter_"+textDirection+"'><a href='"+arrArticleSum[2]+"' target='_blank' rel='noopener'>"+arrArticleSum[3]+"</a> (wikipedia.org)</span><a href='" + arrArticleSum[2] + "' target='_blank' rel='noopener' title='维基百科链接' alt='去维基百科查看完整内容'><span class='wikiBoxLogo-w_"+textDirection+"'><img src='https://niu.fendou.la/wikiPrevBox/w.svg' height='30' width='35'></span></a>";wikiPreviewBox.insertAdjacentHTML("beforeend",wikiBoxfooter),wikiPreviewBox.getElementsByTagName("P")[0].setAttribute("lang",wikiLang),wikiPreviewBox.getElementsByTagName("P")[0].setAttribute("dir",textDirection),showWikiBox()}function showWikiBox(){let wikiPreviewBoxHeight=wikiPreviewBox.getBoundingClientRect().height||400,wikiTermPosBottom=wikiTermPos.bottom,visibleHeight=window.innerHeight;wikiTermPosBottom<wikiPreviewBoxHeight?(wikiPreviewBox.style.top=wikiTermPosBottom+window.scrollY+"px",wikiTermPosBottom+wikiPreviewBoxHeight>visibleHeight&&(wikiPreviewBox.style.top=window.scrollY+"px")):wikiPreviewBox.style.top=wikiTermPos.top+window.scrollY-wikiPreviewBox.getBoundingClientRect().height+"px",wikiPreviewBox.style.opacity=1,wikiPreviewBox.style.visibility="visible"}function hideWikiBox(){wikiTerm.matches(":hover")||(wikiPreviewBox.style.opacity=0,wikiPreviewBox.style.visibility="hidden")}}{document.body.insertAdjacentHTML('afterBegin', '<article id="LinkerPreviewBox" class="LinkerPreviewBox"></article>');let LinkerBoxWidth = 300;let whichArticle = "";let LinkerArticleUrl = "", LinkerTermPos, LinkerTerm;let LinkerPreviewBox = document.getElementById("LinkerPreviewBox");LinkerPreviewBox.addEventListener("click", hideLinkerBox);LinkerPreviewBox.addEventListener("mouseover", showLinkerBox);LinkerPreviewBox.addEventListener("mouseout", hideLinkerBox);let mdContent = document.querySelector(".md-content");let allLinkerLinks =  Array.from(mdContent.querySelectorAll("[href$='/']:not([href*='#'])"));for (let i = 0; i < allLinkerLinks.length; i++) {allLinkerLinks[i].classList.add('LinkerLink');allLinkerLinks[i].addEventListener("mouseover", (e) => {LinkerTerm = e.currentTarget;LinkerArticleUrl = LinkerTerm.href;whichArticle = "" + LinkerArticleUrl.split("/").pop();LinkerTermPos = LinkerTerm.getBoundingClientRect();let LinkerBoxLeft = LinkerTermPos.left - (LinkerBoxWidth / 2) + ((LinkerTermPos.right - LinkerTermPos.left) / 2);if (LinkerBoxLeft < 0) { LinkerBoxLeft = 10; }let winInnerWidth = window.innerWidth; if (winInnerWidth < LinkerBoxWidth) { LinkerBoxLeft = winInnerWidth - LinkerBoxWidth + (LinkerBoxWidth - winInnerWidth); }else {if ((LinkerBoxLeft + LinkerBoxWidth) > winInnerWidth) { LinkerBoxLeft = winInnerWidth - LinkerBoxWidth - 20; } }LinkerPreviewBox.style.left = LinkerBoxLeft + "px";getLinkerPreviewData(LinkerArticleUrl);}, false);allLinkerLinks[i].addEventListener("mouseout", hideLinkerBox);}function getLinkerPreviewData(LinkerArticleUrl) {   let arrArticleSummary = [];if (navigator.onLine) {fetch(LinkerArticleUrl).then(response => {if (response.status >= 200 && response.status <= 299) {response.text().then(function (html){  var parser = new DOMParser();  var doc = parser.parseFromString(html, 'text/html');  var article = doc.querySelector('.md-content').innerHTML;  arrArticleSummary = [article, html.article];  createLinkerBox(arrArticleSummary);})}else {}})}else {}}function createLinkerBox(arrLinkerArticleSum) {let LinkerBoxContent = "";LinkerBoxContent = arrLinkerArticleSum[0];LinkerPreviewBox.innerHTML = LinkerBoxContent;let LinkerBoxfooter = "<span class='LinkerheadLink'><a href='" + LinkerArticleUrl + "' target='_blank' rel='noopener'></a></span>" +"<a href='" + LinkerArticleUrl + "' target='_blank' rel='noopener' title='新窗口打开'" +"<span class='LinkerBoxLogo'><img src='https://niu.fendou.la/wikiPrevBox/starlink.svg'></span></a>";LinkerPreviewBox.insertAdjacentHTML('afterbegin', LinkerBoxfooter);showLinkerBox();}function showLinkerBox() {let LinkerPreviewBoxHeight = LinkerPreviewBox.getBoundingClientRect().height || 400;let LinkerTermPosBottom = LinkerTermPos.bottom;let visibleHeight = window.innerHeight;if (LinkerTermPosBottom < LinkerPreviewBoxHeight) {LinkerPreviewBox.style.top = LinkerTermPosBottom + window.scrollY + 'px';if (LinkerTermPosBottom + LinkerPreviewBoxHeight > visibleHeight) {LinkerPreviewBox.style.top = window.scrollY + 'px';}}else {LinkerPreviewBox.style.top = LinkerTermPos.top + window.scrollY - LinkerPreviewBox.getBoundingClientRect().height + 'px';}LinkerPreviewBox.style.opacity = 1;LinkerPreviewBox.style.visibility = 'visible';}function hideLinkerBox() {if (!LinkerTerm.matches(':hover')) {LinkerPreviewBox.style.opacity = 0;LinkerPreviewBox.style.visibility = 'hidden';}}}
{
    document.body.insertAdjacentHTML('afterBegin', '<article id="StockDataPreviewBox" class="StockDataPreviewBox"></article>');
    let StockDataBoxWidth = 300;
    let whichStock = "";
    let StockUrl = "", StockTermPos, StockTerm;
    let StockDataPreviewBox = document.getElementById("StockDataPreviewBox");
    StockDataPreviewBox.addEventListener("click", hideStockDataBox); 
    StockDataPreviewBox.addEventListener("mouseover", showStockDataBox);
    //StockDataPreviewBox.addEventListener("mouseout", hideStockDataBox);
    let mdContent = document.querySelector(".md-content");
	let allStockDataLinks = Array.from(mdContent.querySelectorAll("[href*='stockchart.ifttt.fun'], [href*='stockbasic.ifttt.fun'], [href*='stockdata.ifttt.fun'], [href*='wencai.ifttt.fun']"));
    for (let i = 0; i < allStockDataLinks.length; i++) {
        allStockDataLinks[i].classList.add('StockDataLink');
        allStockDataLinks[i].addEventListener("mouseover", (e)=>{
            StockTerm = e.currentTarget;
            StockUrl = StockTerm.href;
            whichStock = "" + StockUrl.split("/").pop();
            StockTermPos = StockTerm.getBoundingClientRect();
            let StockDataBoxLeft = StockTermPos.left - (StockDataBoxWidth / 2) + ((StockTermPos.right - StockTermPos.left) / 2);
            if (StockDataBoxLeft < 0) {
                StockDataBoxLeft = 10;
            }
            let winInnerWidth = window.innerWidth;
            if (winInnerWidth < StockDataBoxWidth) {
                StockDataBoxLeft = winInnerWidth - StockDataBoxWidth + (StockDataBoxWidth - winInnerWidth);
            } else {
                if ((StockDataBoxLeft + StockDataBoxWidth) > winInnerWidth) {
                    StockDataBoxLeft = winInnerWidth - StockDataBoxWidth - 20;
                }
            }
            StockDataPreviewBox.style.left = StockDataBoxLeft + "px";
            getStockDataPreviewData(StockUrl);
        }
        , false);
        //allStockDataLinks[i].addEventListener("mouseout", hideStockDataBox); 鼠标移出立即隐藏
		allStockDataLinks[i].addEventListener('click', (event) => { event.preventDefault(); });
    }
    function getStockDataPreviewData(StockUrl) {
      let arrStockDataSummary = [];
      if (navigator.onLine) {
        fetch(StockUrl).then((response) => {
          if (response.status >= 200 && response.status <= 299) {
            response.arrayBuffer().then(function (buffer) {
              // 使用 text-encoding 库转换 GBK 编码的响应
              let decoder = new TextDecoder("gbk");
              let html = decoder.decode(new Uint8Array(buffer));

              var StockDataparser = new DOMParser();
              var StockDatadoc = StockDataparser.parseFromString(
                html,
                "text/html"
              );
              var StockDataarticle;

              // 根据 StockUrl 的不同选择不同的元素
              if (StockUrl.includes("stockchart.ifttt.fun")) {
                let targetDiv =
                  StockDatadoc.querySelector("#hqzs > div").cloneNode(true);
                let unwantedDiv = targetDiv.querySelector("div");
                // 移除原有的不需要的div
                if (unwantedDiv) targetDiv.removeChild(unwantedDiv);
                StockDataarticle = targetDiv.innerHTML;
              } else if (StockUrl.includes("stockdata.ifttt.fun")) {
                StockDataarticle =
                  StockDatadoc.querySelector("#ggsj").innerHTML;
              } else if (StockUrl.includes("stockbasic.ifttt.fun")) {
                StockDataarticle = StockDatadoc.querySelector(
                  "#scrollbar1 > div.viewport"
                ).innerHTML;
              } else if (StockUrl.includes("wencai.ifttt.fun")) {
                StockDataarticle =
                  StockDatadoc.querySelector("#mainContent").innerHTML;
              }
              arrStockDataSummary = [StockDataarticle, html];
              createStockDataBox(arrStockDataSummary);
            });
          }
        });
      }
    } 

    function createStockDataBox(arrStockDataSum) {
        let StockDataContent = "";
        StockDataContent = arrStockDataSum[0];
        StockDataPreviewBox.innerHTML = StockDataContent;
        showStockDataBox();
    }
    function showStockDataBox() {
        let StockDataPreviewBoxHeight = StockDataPreviewBox.getBoundingClientRect().height || 400;
        let StockTermPosBottom = StockTermPos.bottom;
        let visibleHeight = window.innerHeight;
        if (StockTermPosBottom < StockDataPreviewBoxHeight) {
            StockDataPreviewBox.style.top = StockTermPosBottom + window.scrollY + 'px';
            if (StockTermPosBottom + StockDataPreviewBoxHeight > visibleHeight) {
                StockDataPreviewBox.style.top = window.scrollY + 'px';
            }
        } else {
            StockDataPreviewBox.style.top = StockTermPos.top + window.scrollY - StockDataPreviewBox.getBoundingClientRect().height + 'px';
        }
        StockDataPreviewBox.style.opacity = 1;
        StockDataPreviewBox.style.visibility = 'visible';
    }
    function hideStockDataBox() {
        if (!StockTerm.matches(':hover')) {
            StockDataPreviewBox.style.opacity = 0;
            StockDataPreviewBox.style.visibility = 'hidden';
        }
    }
}